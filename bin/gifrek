#!/bin/bash

# Delay before starting
DELAY=1

# Beep to let one know when recording is about to start (and ends)
beep() {
    echo -e "\007" > /dev/`who | awk '{print $2}'` &
}

# Duration and output file
if [ $# -gt 0 ]; then
    D="--duration=$@"
else
    echo Default recording duration 10s to /tmp/gifrek.tmp
    D="--duration=10 /tmp/gifrek.tmp"
fi

# xrectsel from https://github.com/lolilolicon/xrectsel
ARGUMENTS=$(xrectsel "--x=%x --y=%y --width=%w --height=%h") || exit -1

onds. After that, byzanz will start
for (( i=$DELAY; i>0; --i )) ; do
    echo $i
    sleep 1
done

beep
byzanz-record --verbose --delay=0 ${ARGUMENTS} $D --cursor
beep

# Upload to gyazoecho Delaying $DELAY sec
curl -XPOST https://upload.gyazo.com/upload.cgi -F "imagedata=@/tmp/gifrek.tmp" -A 'Gifrek/0.1 (+https://github.com/drobune/gifrek)'

